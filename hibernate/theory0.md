# Hibernate

## Введение

Hibernate Framework — это фреймворк для языка Java, предназначенный для работы с
базами данных. Он реализует объектно-реляционную модель — технологию, которая
«соединяет» программные сущности и соответствующие записи в базе.

Объектно-реляционная модель, или ORM, позволяет создать программную
«виртуальную» базу данных из объектов. Объекты описываются на языках
программирования с применением принципов ООП. Java Hibernate — популярное
воплощение этой модели.

Hibernate построен на спецификации JPA 2.1 — наборе правил, который описывает
взаимодействие программных объектов с записями в базах данных. JPA поясняет, как
управлять сохранением данных из кода на Java в базу. Но сама по себе
спецификация — только теоретические правила, а в «чистой» Java ее реализации
нет.

### Особенности Hibernate Framework

Идея фреймворка — создать «виртуальную» базу данных из программных объектов и
работать с ней как с реальной базой. Поэтому им часто пользуются для упрощения
работы. Он берет на себя взаимодействие с реляционной БД, а разработчику
остается работать с кодом.
В Hibernate есть возможность, которую называют «ленивой загрузкой». Объекты в
фреймворке не подгружают всю информацию из базы изначально. Вместо этого они
просто «знают», как ее получить, и при первом обращении к информации загружают
ее в фоне. Это нужно для оптимизации производительности.

Внутри Hibernate — собственный язык запросов Hibernate Query Language, или HQL.
Это SQL-подобный язык, но полностью объектно-ориентированный и более краткий —
не приходится так много работать с шаблонным кодом, как в «чистом» SQL.

### Преимущества использования Hibernate

**Популярность.** Hibernate — популярный фреймворк, который фактически считают
золотым стандартом. Это влечет за собой сразу три преимущества:

- по нему много учебников, туториалов и обсуждений на специализированных сайтах;
- большинство технологий, работающих с Java, поддерживают Hibernate. Это базы
  данных, фреймворки, библиотеки. Существуют плагины и для других языков или
  платформ, например порт на платформу .NET;
- разработчик, умеющий работать с этим фреймворком, всегда найдет работу.
  **Устранение лишнего кода.** Повторяющийся шаблонный код, который делает
  программу менее читаемой, называют «спагетти». Если программа взаимодействует
  с базой, то в ней по определению много «спагетти»-кода, в том числе
  низкоуровневого. Использование Hibernate позволяет сократить количество
  «спагетти», соответственно, сделать программу более лаконичной и хорошо
  читаемой.

**Возможность сосредоточиться на логике.** Разработчику не приходится писать
множество запросов, он избавлен от написания большого количества «технического»
низкоуровневого кода. Поэтому можно сосредоточиться на логике работы программы и
не отвлекаться на шаблонные задачи, поручив их фреймворку. Это облегчает и
ускоряет разработку.

**Независимость от базы данных.** Hibernate может работать с любой базой и не
имеет жесткой привязки к какой-то конкретной базе или СУБД. Благодаря этому он
гибкий, его можно использовать в связке с другими технологиями. Язык запросов у
него тоже свой, независимый от СУБД, хотя Hibernate поддерживает и «чистый» SQL.

**Объектно-ориентированный подход.** Hibernate реализует парадигму
объектно-ориентированного программирования, которая очень распространена и
хорошо знакома разработчикам. Поэтому работать с ним относительно просто, если
вы уже знаете основы: не приходится постоянно отвлекаться на совершенно другую
логику работы с базами данных. Можно реализовать все управление на ООП — этому
способствует и наличие собственного SQL-подобного объектно-ориентированного
языка запросов.

### Недостатки Hibernate Framework

**Сложность в освоении.** Эта проблема актуальна в основном для новичков. Для
работы с фреймворком нужно понимать теорию реляционных БД. Понадобится знать,
что такое транзакция, по каким принципам работают базы данных, как с ними
взаимодействовать и многое другое. Естественно, надо знать Java: осваивать
фреймворки советуют после изучения основных принципов «чистого» языка.

**Проблемы с производительностью.** Несмотря на возможности, которые дает
«ленивая загрузка», спецификацию JPA и в частности Hibernate часто критикуют за
низкую производительность. Есть мнение, которое частично подкрепляется на
практике, что такой тип взаимодействия с базой замедляет и утяжеляет код.

**Непредсказуемость кода.** Это еще один частый пункт критики JPA и Hibernate
как ее реализации. Спецификация построена на объектно-ориентированной модели
программирования, но не полностью соблюдает ее принципы. Это приводит к тому,
что в коде могут появиться побочные эффекты — так называется явление, когда во
время выполнения программы какие-то значения неявно изменяются. Побочные эффекты
могут влиять на правильность работы программы, так что их надо избегать. А при
использовании JPA избежать их сложно, и к Hibernate это тоже относится.

**Сложности с кэшированием.** В целом информацию в Hibernate можно кэшировать,
то есть сохранять в специальном участке памяти, очень быстром и компактном. Это
один из плюсов фреймворка — кэширование важно для производительности. Оно нужно
для быстрого доступа к важным данным.

На практике кэширование самих сущностей JPA работает своеобразно:

- изменяемые сущности кэшировать не получится — инструментарий не дает
  возможности синхронизировать изменения с кэшем;
- неизменяемые сущности кэшировать можно, но не полноценно. Сущность загружается
  из базы через транзакцию — последовательность запросов в БД. Когда транзакция
  закрывается, на кэшированную сущность становится нельзя сослаться — только
  получить из нее данные.

## Архитектура

Hibernate состоит из таких частей как:

- **Transaction** - Этот объект представляет собой рабочую единицу работы с БД.
  В
  Hibernate транзакции обрабатываются менеджером транзакций.
- **SessionFactory** - Самый важный и самый тяжёлый объект (обычно создаётся в
  единственном экземпляре, при запуске приложения). Нам необходима как минимум
  одна SessionFactory для каждой БД, каждый из которых конфигурируется отдельным
  конфигурационным файлом.
- **Session** - Сессия используется для получения физического соединения с БД.
  Обычно, сессия создаётся при необходимости, а после этого закрывается. Это
  связано с тем, что эти объекты крайне легковесны. Чтобы понять, что это такое,
  модно сказать, что создание, чтение, изменение и удаление объектов происходит
  через объект Session.
- **Query** - Этот объект использует HQL или SQL для чтения/записи данных из/в
  БД.
  Экземпляр запроса используется для связывания параметров запроса, ограничения
  количества результатов, которые будут возвращены и для выполнения запроса.
- **Configuration** - Этот объект используется для создания объекта
  SessionFactory и
  конфигурирует сам Hibernate с помощью конфигурационного XML-файла, который
  объясняет, как обрабатывать объект Session.
- **Criteria** - Используется для создания и выполнения объекто-ориентированного
  запроса для получения объектов.


